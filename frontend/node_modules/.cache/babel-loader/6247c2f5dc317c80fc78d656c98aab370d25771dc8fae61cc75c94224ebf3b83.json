{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';import{getApiUrl}from'../config/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);export const AuthProvider=_ref=>{let{children}=_ref;const[auth,setAuth]=useState(()=>{const token=localStorage.getItem('token');const storedUser=localStorage.getItem('user');const user=storedUser?JSON.parse(storedUser):null;console.log('Инициализация AuthContext:',{token,user});if(token&&user){axios.defaults.headers.common['Authorization']=`Bearer ${token}`;}return{token,user,isAuthenticated:!!token&&!!user,isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'};});const login=(token,user)=>{console.log('Вызван метод login:',{token,user});localStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(user));axios.defaults.headers.common['Authorization']=`Bearer ${token}`;setAuth({token,user,isAuthenticated:true,isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'});};const logout=()=>{console.log('Вызван метод logout');localStorage.removeItem('token');localStorage.removeItem('user');delete axios.defaults.headers.common['Authorization'];setAuth({token:null,user:null,isAuthenticated:false,isAdmin:false});};// Проверка токена при загрузке\nuseEffect(()=>{const validateToken=async()=>{const token=localStorage.getItem('token');if(token){try{console.log('Проверка токена...');const response=await axios.get(getApiUrl('/api/auth/me'),{headers:{Authorization:`Bearer ${token}`}});const user=response.data;console.log('Токен валиден, пользователь:',user);setAuth({token,user,isAuthenticated:true,isAdmin:(user===null||user===void 0?void 0:user.role)==='admin'});}catch(error){console.error('Ошибка валидации токена:',error);logout();}}else{console.log('Токен не найден');}};validateToken();},[]);const contextValue={...auth,login,logout};console.log('AuthContext текущее состояние:',contextValue);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth должен использоваться внутри AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","getApiUrl","jsx","_jsx","AuthContext","AuthProvider","_ref","children","auth","setAuth","token","localStorage","getItem","storedUser","user","JSON","parse","console","log","defaults","headers","common","isAuthenticated","isAdmin","role","login","setItem","stringify","logout","removeItem","validateToken","response","get","Authorization","data","error","contextValue","Provider","value","useAuth","context","Error"],"sources":["/home/renat/Project_1/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport axios from 'axios';\nimport { getApiUrl } from '../config/api';\n\nconst AuthContext = createContext(null);\n\nexport const AuthProvider = ({ children }) => {\n    const [auth, setAuth] = useState(() => {\n        const token = localStorage.getItem('token');\n        const storedUser = localStorage.getItem('user');\n        const user = storedUser ? JSON.parse(storedUser) : null;\n        \n        console.log('Инициализация AuthContext:', { token, user });\n        \n        if (token && user) {\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        }\n        \n        return {\n            token,\n            user,\n            isAuthenticated: !!token && !!user,\n            isAdmin: user?.role === 'admin'\n        };\n    });\n\n    const login = (token, user) => {\n        console.log('Вызван метод login:', { token, user });\n        localStorage.setItem('token', token);\n        localStorage.setItem('user', JSON.stringify(user));\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        setAuth({\n            token,\n            user,\n            isAuthenticated: true,\n            isAdmin: user?.role === 'admin'\n        });\n    };\n\n    const logout = () => {\n        console.log('Вызван метод logout');\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        delete axios.defaults.headers.common['Authorization'];\n        setAuth({\n            token: null,\n            user: null,\n            isAuthenticated: false,\n            isAdmin: false\n        });\n    };\n\n    // Проверка токена при загрузке\n    useEffect(() => {\n        const validateToken = async () => {\n            const token = localStorage.getItem('token');\n            if (token) {\n                try {\n                    console.log('Проверка токена...');\n                    const response = await axios.get(getApiUrl('/api/auth/me'), {\n                        headers: { Authorization: `Bearer ${token}` }\n                    });\n                    const user = response.data;\n                    console.log('Токен валиден, пользователь:', user);\n                    setAuth({\n                        token,\n                        user,\n                        isAuthenticated: true,\n                        isAdmin: user?.role === 'admin'\n                    });\n                } catch (error) {\n                    console.error('Ошибка валидации токена:', error);\n                    logout();\n                }\n            } else {\n                console.log('Токен не найден');\n            }\n        };\n\n        validateToken();\n    }, []);\n\n    const contextValue = {\n        ...auth,\n        login,\n        logout\n    };\n\n    console.log('AuthContext текущее состояние:', contextValue);\n\n    return (\n        <AuthContext.Provider value={contextValue}>\n            {children}\n        </AuthContext.Provider>\n    );\n};\n\nexport const useAuth = () => {\n    const context = useContext(AuthContext);\n    if (!context) {\n        throw new Error('useAuth должен использоваться внутри AuthProvider');\n    }\n    return context;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}