# Настройка канонических URL на уровне Nginx

Помимо настройки канонических URL на уровне HTML-страниц, можно также настроить их на уровне веб-сервера Nginx. Это обеспечит дополнительный уровень защиты от проблем с дублированием контента.

## Преимущества настройки на уровне сервера

1. Централизованное управление - все изменения вносятся в одном месте
2. Более надежная защита от дублирования контента
3. Работает даже для статических файлов, которые не содержат метатегов
4. Снижает нагрузку на передачу данных, так как заголовки меньше HTML-страниц

## Настройка с помощью заголовка Link

В Nginx можно добавить HTTP-заголовок `Link` со значением канонического URL:

```nginx
# Добавьте этот блок в секцию server вашего конфигурационного файла Nginx
server {
    # Существующие настройки...
    
    # Добавление заголовка Link для канонических URL
    add_header Link '<https://escort-bar.live$request_uri>; rel="canonical"' always;
    
    # Другие настройки...
}
```

## Настройка редиректов для старого домена

Если старый домен (xn--80adhe8ahe2f.ru) всё ещё активен, рекомендуется настроить 301 редирект на новый домен:

```nginx
server {
    listen 80;
    listen 443 ssl;
    server_name xn--80adhe8ahe2f.ru www.xn--80adhe8ahe2f.ru;
    
    # SSL настройки для старого домена (если есть)
    # ...
    
    # Редирект на новый домен с сохранением пути
    return 301 https://escort-bar.live$request_uri;
}
```

## Применение изменений в Nginx

После внесения изменений в конфигурацию Nginx, необходимо проверить синтаксис и перезагрузить сервер:

```bash
# Проверка синтаксиса
ssh root@185.255.120.50 "nginx -t"

# Если проверка успешна, перезагрузите конфигурацию
ssh root@185.255.120.50 "systemctl reload nginx"
```

## Проверка результатов

Чтобы проверить, что заголовок Link с каноническим URL добавляется правильно, выполните:

```bash
curl -I https://escort-bar.live
```

В результате должен отображаться заголовок вида:

```
Link: <https://escort-bar.live/>; rel="canonical"
```

## Дополнительные рекомендации

1. Для мультиязычных сайтов можно настроить разные канонические URL для разных языковых версий
2. Можно комбинировать заголовки Link с метатегами canonical в HTML
3. Для частей сайта с разными доменами (субдоменами) могут потребоваться отдельные настройки

## Важные замечания

- Изменения на уровне Nginx не заменяют, а дополняют метатеги canonical в HTML
- При использовании CDN убедитесь, что ваши заголовки сохраняются после кеширования
- Проверяйте наличие заголовка Link в ответах сервера после внесения изменений 