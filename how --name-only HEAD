[33mcommit 78e4a80266ca4610c5212093de7c1db204abb30b[m[33m ([m[1;36mHEAD[m[33m -> [m[1;32mmain[m[33m)[m
Author: Promeney25 <grib0195@gmail.com>
Date:   Mon Mar 24 00:19:34 2025 +0400

    –ü–æ–≤—ã—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ API —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ production

[1mdiff --git a/backend/index.js b/backend/index.js[m
[1mindex d71e9fa8..b6a4871b 100644[m
[1m--- a/backend/index.js[m
[1m+++ b/backend/index.js[m
[36m@@ -83,6 +83,18 @@[m [mif (!fs.existsSync(backgroundsDir)) {[m
 app.post('/api/auth/login', authController.login);[m
 app.post('/api/auth/register', authController.register);[m
 app.get('/api/auth/me', authController.requireAuth, authController.getCurrentUser);[m
[32m+[m[32m// –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è[m
[32m+[m[32mapp.post('/api/auth/change-password', authController.requireAuth, authController.changePassword);[m
[32m+[m
[32m+[m[32m// –ú–∞—Ä—à—Ä—É—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏[m
[32m+[m[32mif (process.env.NODE_ENV !== 'production') {[m
[32m+[m[32m  app.post('/api/auth/change-admin-password', authController.requireAdmin, authController.changeAdminPassword);[m
[32m+[m[32m} else {[m
[32m+[m[32m  // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 404 –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏[m
[32m+[m[32m  app.post('/api/auth/change-admin-password', (req, res) => {[m
[32m+[m[32m    res.status(404).json({ message: '–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω' });[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
 [m
 // –ú–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–æ—Ñ–∏–ª–µ–π[m
 app.get('/api/profiles', authController.requireAdmin, profileController.getAllProfiles);[m
[36m@@ -125,7 +137,7 @@[m [mapp.use((err, req, res, next) => {[m
     res.status(500).json({ message: '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' });[m
 });[m
 [m
[31m-const PORT = process.env.PORT || 5000;[m
[32m+[m[32mconst PORT = process.env.PORT || (process.env.NODE_ENV === 'production' ? 8080 : 5000);[m
 [m
 // –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞[m
 async function startServer() {[m
[36m@@ -138,8 +150,41 @@[m [masync function startServer() {[m
             process.exit(1);[m
         }[m
 [m
[31m-        app.listen(PORT, () => {[m
[32m+[m[32m        console.log(`–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ ${process.env.NODE_ENV || 'development'} –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}...`);[m
[32m+[m[32m        const server = app.listen(PORT, () => {[m
             console.log(`–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);[m
[32m+[m[32m        }).on('error', (err) => {[m
[32m+[m[32m            if (err.code === 'EADDRINUSE') {[m
[32m+[m[32m                console.error(`–ü–æ—Ä—Ç ${PORT} —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.`);[m
[32m+[m[41m                [m
[32m+[m[32m                if (process.env.NODE_ENV === 'production') {[m
[32m+[m[32m                    console.error('–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ PM2: pm2 restart all');[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    console.error('–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É npm run free-port');[m
[32m+[m[32m                }[m
[32m+[m[41m                [m
[32m+[m[32m                process.exit(1);[m
[32m+[m[32m            } else {[m
[32m+[m[32m                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞:', err);[m
[32m+[m[32m                process.exit(1);[m
[32m+[m[32m            }[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã[m
[32m+[m[32m        process.on('SIGTERM', () => {[m
[32m+[m[32m            console.log('–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª SIGTERM. –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Ä–≤–µ—Ä–∞...');[m
[32m+[m[32m            server.close(() => {[m
[32m+[m[32m                console.log('–°–µ—Ä–≤–µ—Ä –∑–∞–∫—Ä—ã—Ç');[m
[32m+[m[32m                process.exit(0);[m
[32m+[m[32m            });[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        process.on('SIGINT', () => {[m
[32m+[m[32m            console.log('–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª SIGINT. –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Ä–≤–µ—Ä–∞...');[m
[32m+[m[32m            server.close(() => {[m
[32m+[m[32m                console.log('–°–µ—Ä–≤–µ—Ä –∑–∞–∫—Ä—ã—Ç');[m
[32m+[m[32m                process.exit(0);[m
[32m+[m[32m            });[m
         });[m
     } catch (error) {[m
         console.error('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error);[m
[1mdiff --git a/backend/scripts/change-admin-password.js b/backend/scripts/change-admin-password.js[m
[1mnew file mode 100644[m
[1mindex 00000000..77558405[m
[1m--- /dev/null[m
[1m+++ b/backend/scripts/change-admin-password.js[m
[36m@@ -0,0 +1,139 @@[m
[32m+[m[32m/**[m
[32m+[m[32m * –°–∫—Ä–∏–ø—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞[m
[32m+[m[32m * –ó–∞–ø—É—Å–∫: node scripts/change-admin-password.js [newPassword][m
[32m+[m[32m * –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö, —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç –µ–≥–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ[m
[32m+[m[32m *[m[41m [m
[32m+[m[32m * –í–ê–ñ–ù–û: –í production —Å—Ä–µ–¥–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ API –æ—Ç–∫–ª—é—á–µ–Ω–æ.[m
[32m+[m[32m * –≠—Ç–æ—Ç CLI-—Å–∫—Ä–∏–ø—Ç —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞[m
[32m+[m[32m * –≤ production —Å—Ä–µ–¥–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.[m
[32m+[m[32m */[m
[32m+[m
[32m+[m[32mrequire('dotenv').config();[m
[32m+[m[32mconst { User } = require('../models');[m
[32m+[m[32mconst bcrypt = require('bcryptjs');[m
[32m+[m[32mconst readline = require('readline');[m
[32m+[m[32mconst { hashPassword } = require('../services/passwordService');[m
[32m+[m
[32m+[m[32m// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ[m
[32m+[m[32mconst NODE_ENV = process.env.NODE_ENV || 'development';[m
[32m+[m[32mconsole.log(`–û–∫—Ä—É–∂–µ–Ω–∏–µ: ${NODE_ENV}`);[m
[32m+[m
[32m+[m[32m// –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —á—Ç–µ–Ω–∏—è –≤–≤–æ–¥–∞[m
[32m+[m[32mconst rl = readline.createInterface({[m
[32m+[m[32m  input: process.stdin,[m
[32m+[m[32m  output: process.stdout[m
[32m+[m[32m});[m
[32m+[m
[32m+[m[32m// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è (–±–µ–∑ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏)[m
[32m+[m[32mfunction getPasswordFromConsole(prompt) {[m
[32m+[m[32m  return new Promise((resolve) => {[m
[32m+[m[32m    // –í –∏–¥–µ–∞–ª–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã —Å–∫—Ä—ã—Ç—å –≤–≤–æ–¥, –Ω–æ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ –≤ Node.js[m
[32m+[m[32m    // –ü–æ—ç—Ç–æ–º—É –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è[m
[32m+[m[32m    console.log('–í–ù–ò–ú–ê–ù–ò–ï: –í —Ü–µ–ª—è—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.');[m
[32m+[m[32m    rl.question(prompt, (password) => {[m
[32m+[m[32m      resolve(password);[m
[32m+[m[32m    });[m
[32m+[m[32m  });[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è[m
[32m+[m[32mfunction checkPasswordStrength(password) {[m
[32m+[m[32m  if (password.length < 8) {[m
[32m+[m[32m    return { valid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤' };[m
[32m+[m[32m  }[m
[32m+[m[41m  [m
[32m+[m[32m  if (!/[A-Z]/.test(password)) {[m
[32m+[m[32m    return { valid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∑–∞–≥–ª–∞–≤–Ω—É—é –±—É–∫–≤—É' };[m
[32m+[m[32m  }[m
[32m+[m[41m  [m
[32m+[m[32m  if (!/[a-z]/.test(password)) {[m
[32m+[m[32m    return { valid: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂